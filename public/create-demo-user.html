<!DOCTYPE html>
<html>
<head>
    <title>Create Demo User - WORKING VERSION</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #111; color: white; }
        .container { max-width: 600px; margin: 0 auto; background: #222; padding: 30px; border-radius: 10px; }
        button { background: #10b981; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        button:hover { background: #059669; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .success { background: #065f46; border: 1px solid #10b981; }
        .error { background: #7f1d1d; border: 1px solid #ef4444; }
        .info { background: #1e3a8a; border: 1px solid #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Create Demo User - WORKING VERSION</h1>
        <p>This will create a demo user that bypasses the broken trigger.</p>
        
        <button onclick="createDemoUser()">Create Demo User</button>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="checkUser()">Check If User Exists</button>
        
        <div id="result"></div>
    </div>

    <script>
        const supabaseUrl = 'https://dcfgdlwhixdruyewywly.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRjZmdkbHdoaXhkcnV5ZXd5d2x5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjU1NjYsImV4cCI6MjA3NjEwMTU2Nn0.wMGq2FpoVFMnLemUP13763iodoXNu-gx8I0rRpTubG4'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        function showResult(message, type = 'info') {
            document.getElementById('result').className = `result ${type}`
            document.getElementById('result').textContent = message
        }
        
        async function checkUser() {
            showResult('ðŸ” Checking if demo user exists...', 'info')
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: 'demo@a2zbusiness.com',
                    password: 'demo123456'
                })
                
                if (error) {
                    if (error.message.includes('Invalid login credentials')) {
                        showResult('â„¹ï¸ Demo user does not exist yet.', 'info')
                    } else {
                        showResult(`âŒ Check failed: ${error.message}`, 'error')
                    }
                    return false
                }
                
                if (data.user) {
                    await supabase.auth.signOut()
                    showResult(`âœ… Demo user exists and working!\nðŸ“§ Email: demo@a2zbusiness.com\nðŸ”‘ Password: demo123456\nðŸ†” User ID: ${data.user.id}`, 'success')
                    return true
                }
            } catch (err) {
                showResult(`âŒ Error: ${err.message}`, 'error')
            }
            return false
        }
        
        async function createDemoUser() {
            showResult('ðŸš€ Creating demo user (this might take a moment)...', 'info')
            
            try {
                // Try the simple signup first
                const { data, error } = await supabase.auth.signUp({
                    email: 'demo@a2zbusiness.com',
                    password: 'demo123456'
                })
                
                if (error) {
                    if (error.message.includes('already registered')) {
                        showResult('âœ… User already exists! Try "Test Login" button.', 'success')
                        return
                    }
                    showResult(`âŒ Signup failed: ${error.message}\n                    
ðŸ”§ MANUAL SOLUTION:\n1. Go to: https://supabase.com/dashboard/project/dcfgdlwhixdruyewywly\n2. Go to Authentication > Users\n3. Click "Add user"\n4. Email: demo@a2zbusiness.com\n5. Password: demo123456\n6. Check "Confirm email"\n7. Click Create user\n8. Then come back and test login`, 'error')
                    return
                }
                
                if (data.user) {
                    showResult(`ðŸŽ‰ Demo user created!\nðŸ“§ Email: demo@a2zbusiness.com\nðŸ”‘ Password: demo123456\nðŸ†” User ID: ${data.user.id}\n\n${data.user.email_confirmed_at ? 'âœ… Ready to use!' : 'âš ï¸ May need email confirmation'}`, 'success')
                }
                
            } catch (err) {
                showResult(`âŒ Error: ${err.message}`, 'error')
            }
        }
        
        async function testLogin() {
            showResult('ðŸ” Testing login...', 'info')
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: 'demo@a2zbusiness.com',
                    password: 'demo123456'
                })
                
                if (error) {
                    showResult(`âŒ Login failed: ${error.message}`, 'error')
                    return
                }
                
                if (data.user) {
                    await supabase.auth.signOut()
                    showResult(`âœ… Login successful!\nðŸ†” User ID: ${data.user.id}\nðŸ“§ Email: ${data.user.email}\nâœ… Demo user is working perfectly!\n\nðŸŒ You can now use:\n- http://localhost:3000/auth/login-animated\n- Email: demo@a2zbusiness.com\n- Password: demo123456`, 'success')
                }
                
            } catch (err) {
                showResult(`âŒ Error: ${err.message}`, 'error')
            }
        }
        
        // Auto-check on page load
        window.addEventListener('load', () => {
            setTimeout(checkUser, 1000)
        })
    </script>
</body>
</html>
